function url(e){return"undefined"==typeof e&&(e=""),-1!==e.indexOf("http")?e:host+e}function redirect(e){window.location=url(e)}function componentToHex(e){var n=e.toString(16);return 1==n.length?"0"+n:n}function rgbToHex(e,n,o){return"#"+componentToHex(e)+componentToHex(n)+componentToHex(o)}function LongPress(e,n){this.length_=n;var o=this;o.map_=e,o.timeoutId_=null,google.maps.event.addListener(e,"mousedown",function(e){o.onMouseDown_(e)}),google.maps.event.addListener(e,"mouseup",function(e){o.onMouseUp_(e)}),google.maps.event.addListener(e,"drag",function(e){o.onMapDrag_(e)})}LongPress.prototype.onMouseUp_=function(e){clearTimeout(this.timeoutId_)},LongPress.prototype.onMouseDown_=function(e){clearTimeout(this.timeoutId_);var n=this.map_,o=e;this.timeoutId_=setTimeout(function(){google.maps.event.trigger(n,"longpress",o)},this.length_)},LongPress.prototype.onMapDrag_=function(e){clearTimeout(this.timeoutId_)},google.maps.Map.prototype.clearMarkers=function(e){for(var n=0;n<e.length;n++)e[n].circle&&e[n].circle.setMap(null),e[n].setMap(null)};var app=angular.module("app",[]),isMobile=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(isMobile=!0),app.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",e.defaults.transformRequest.unshift(function(e,n){var o,t=[];if("string"==typeof e)return e;for(o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")})}]);var header_handle_errors="pGO-Map-Handle-Errors-Generically",specificallyHandleInProgress=!1;app.factory("RequestsErrorHandler",["$q",function(e){return{specificallyHandled:function(e){specificallyHandleInProgress=!0;try{return e()}finally{specificallyHandleInProgress=!1}},responseError:function(n){var o=n&&n.config&&n.config.headers&&n.config.headers[header_handle_errors];return o&&console.warn(n.data.message),e.reject(n)}}}]),app.config(["$provide","$httpProvider",function(e,n){function o(e){return e=e||{},e.headers=e.headers||{},specificallyHandleInProgress||(e.headers[header_handle_errors]=!0),e}n.interceptors.push("RequestsErrorHandler"),e.decorator("$http",["$delegate",function(e){function n(n){return function(t,r){return e[n](t,o(r))}}function t(n){return function(t,r,a){return e[n](t,r,o(a))}}function r(n){for(var o in e)n.hasOwnProperty(o)||("function"==typeof e[o]?n[o]=function(){return e[o].apply(e,arguments)}:n[o]=e[o])}var a=function(n){return e(o(n))};return a.get=n("get"),a["delete"]=n("delete"),a.head=n("head"),a.jsonp=n("jsonp"),a.post=t("post"),a.put=t("put"),r(a),a}])}]);var CanvasImage=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=e.width,this.height=this.canvas.height=e.height,this.context.drawImage(e,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(e){this.context.putImageData(e,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(e,n){var o=this.getPalette(e,5,n),t=o[0];return t},ColorThief.prototype.getPalette=function(e,n,o){"undefined"==typeof n&&(n=10),("undefined"==typeof o||1>o)&&(o=10);for(var t,r,a,i,c,s=new CanvasImage(e),u=s.getImageData(),l=u.data,p=s.getPixelCount(),d=[],f=0;p>f;f+=o)t=4*f,r=l[t+0],a=l[t+1],i=l[t+2],c=l[t+3],c>=125&&(r>250&&a>250&&i>250||d.push([r,a,i]));var m=MMCQ.quantize(d,n),g=m?m.palette():null;return s.removeCanvas(),g},!pv)var pv={map:function(e,n){var o={};return n?e.map(function(e,t){return o.index=t,n.call(o,e)}):e.slice()},naturalOrder:function(e,n){return n>e?-1:e>n?1:0},sum:function(e,n){var o={};return e.reduce(n?function(e,t,r){return o.index=r,e+n.call(o,t)}:function(e,n){return e+n},0)},max:function(e,n){return Math.max.apply(null,n?pv.map(e,n):e)}};var MMCQ=function(){function e(e,n,o){return(e<<2*s)+(n<<s)+o}function n(e){function n(){o.sort(e),t=!0}var o=[],t=!1;return{push:function(e){o.push(e),t=!1},peek:function(e){return t||n(),void 0===e&&(e=o.length-1),o[e]},pop:function(){return t||n(),o.pop()},size:function(){return o.length},map:function(e){return o.map(e)},debug:function(){return t||n(),o}}}function o(e,n,o,t,r,a,i){var c=this;c.r1=e,c.r2=n,c.g1=o,c.g2=t,c.b1=r,c.b2=a,c.histo=i}function t(){this.vboxes=new n(function(e,n){return pv.naturalOrder(e.vbox.count()*e.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function r(n){var o,t,r,a,i=1<<3*s,c=new Array(i);return n.forEach(function(n){t=n[0]>>u,r=n[1]>>u,a=n[2]>>u,o=e(t,r,a),c[o]=(c[o]||0)+1}),c}function a(e,n){var t,r,a,i=1e6,c=0,s=1e6,l=0,p=1e6,d=0;return e.forEach(function(e){t=e[0]>>u,r=e[1]>>u,a=e[2]>>u,i>t?i=t:t>c&&(c=t),s>r?s=r:r>l&&(l=r),p>a?p=a:a>d&&(d=a)}),new o(i,c,s,l,p,d,n)}function i(n,o){function t(e){var n,t,r,a,i,c=e+"1",u=e+"2",l=0;for(s=o[c];s<=o[u];s++)if(m[s]>f/2){for(r=o.copy(),a=o.copy(),n=s-o[c],t=o[u]-s,i=t>=n?Math.min(o[u]-1,~~(s+t/2)):Math.max(o[c],~~(s-1-n/2));!m[i];)i++;for(l=g[i];!l&&m[i-1];)l=g[--i];return r[u]=i,a[c]=r[u]+1,[r,a]}}if(o.count()){var r=o.r2-o.r1+1,a=o.g2-o.g1+1,i=o.b2-o.b1+1,c=pv.max([r,a,i]);if(1==o.count())return[o.copy()];var s,u,l,p,d,f=0,m=[],g=[];if(c==r)for(s=o.r1;s<=o.r2;s++){for(p=0,u=o.g1;u<=o.g2;u++)for(l=o.b1;l<=o.b2;l++)d=e(s,u,l),p+=n[d]||0;f+=p,m[s]=f}else if(c==a)for(s=o.g1;s<=o.g2;s++){for(p=0,u=o.r1;u<=o.r2;u++)for(l=o.b1;l<=o.b2;l++)d=e(u,s,l),p+=n[d]||0;f+=p,m[s]=f}else for(s=o.b1;s<=o.b2;s++){for(p=0,u=o.r1;u<=o.r2;u++)for(l=o.g1;l<=o.g2;l++)d=e(u,l,s),p+=n[d]||0;f+=p,m[s]=f}return m.forEach(function(e,n){g[n]=f-e}),t(c==r?"r":c==a?"g":"b")}}function c(e,o){function c(e,n){for(var o,t=1,r=0;l>r;)if(o=e.pop(),o.count()){var a=i(s,o),c=a[0],u=a[1];if(!c)return;if(e.push(c),u&&(e.push(u),t++),t>=n)return;if(r++>l)return}else e.push(o),r++}if(!e.length||2>o||o>256)return!1;var s=r(e),u=0;s.forEach(function(){u++});var d=a(e,s),f=new n(function(e,n){return pv.naturalOrder(e.count(),n.count())});f.push(d),c(f,p*o);for(var m=new n(function(e,n){return pv.naturalOrder(e.count()*e.volume(),n.count()*n.volume())});f.size();)m.push(f.pop());c(m,o-m.size());for(var g=new t;m.size();)g.push(m.pop());return g}var s=5,u=8-s,l=1e3,p=.75;return o.prototype={volume:function(e){var n=this;return(!n._volume||e)&&(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(n){var o=this,t=o.histo;if(!o._count_set||n){var r,a,i,c=0;for(r=o.r1;r<=o.r2;r++)for(a=o.g1;a<=o.g2;a++)for(i=o.b1;i<=o.b2;i++)index=e(r,a,i),c+=t[index]||0;o._count=c,o._count_set=!0}return o._count},copy:function(){var e=this;return new o(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(n){var o=this,t=o.histo;if(!o._avg||n){var r,a,i,c,u,l=0,p=1<<8-s,d=0,f=0,m=0;for(a=o.r1;a<=o.r2;a++)for(i=o.g1;i<=o.g2;i++)for(c=o.b1;c<=o.b2;c++)u=e(a,i,c),r=t[u]||0,l+=r,d+=r*(a+.5)*p,f+=r*(i+.5)*p,m+=r*(c+.5)*p;l?o._avg=[~~(d/l),~~(f/l),~~(m/l)]:o._avg=[~~(p*(o.r1+o.r2+1)/2),~~(p*(o.g1+o.g2+1)/2),~~(p*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(e){var n=this,o=e[0]>>u;return gval=e[1]>>u,bval=e[2]>>u,o>=n.r1&&o<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},t.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var n=this.vboxes,o=0;o<n.size();o++)if(n.peek(o).vbox.contains(e))return n.peek(o).color;return this.nearest(e)},nearest:function(e){for(var n,o,t,r=this.vboxes,a=0;a<r.size();a++)o=Math.sqrt(Math.pow(e[0]-r.peek(a).color[0],2)+Math.pow(e[1]-r.peek(a).color[1],2)+Math.pow(e[2]-r.peek(a).color[2],2)),(n>o||void 0===n)&&(n=o,t=r.peek(a).color);return t},forcebw:function(){var e=this.vboxes;e.sort(function(e,n){return pv.naturalOrder(pv.sum(e.color),pv.sum(n.color))});var n=e[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(e[0].color=[0,0,0]);var o=e.length-1,t=e[o].color;t[0]>251&&t[1]>251&&t[2]>251&&(e[o].color=[255,255,255])}},{quantize:c}}();app.factory("ApiService",["$rootScope",function(e){"use strict";var n=this;return n.token=null,n.addMarker=function(){},n.removeMarker=function(){},n.registerNewUser=function(){},n.token=function(){},n.request=function(){},n}]),app.factory("InitService",["$document",function(e){"use strict";function n(){$(document).on("ajaxStart",function(e){}),$(document).on("ajaxComplete",function(e){}),o.fixDateInputs(),o.triggerReady(),o.ready=!0}var o=this,t={ready:[]};return o.ready=!1,o.addEventListener=function(e,n){t[e].push(n),o.ready&&o.bindOnTheFlyReadyEvents()},o.triggerReady=function(){var e;for(e=0;e<t.ready.length;e+=1)t.ready[e](),t.ready.splice(e,1)},o.fixDateInputs=function(){$('input[type="date"], input[type="datetime"], input[type="datetime-local"], input[type="month"], input[type="time"], input[type="week"]').each(function(){var e=this,n=$(e),o=n.attr("type");""==n.val()&&n.attr("type","text"),n.focus(function(){n.attr("type",o),e.click()}),n.blur(function(){""==n.val()&&n.attr("type","text")})})},o.init=function(){!function(){e.ready(function(){-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?(console.log("Using Cordova/PhoneGap setting"),document.addEventListener("deviceready",n,!1)):(console.log("Using web browser setting"),n())})}()},o.bindOnTheFlyReadyEvents=function(){e.ready(function(){o.triggerReady()})},o.init(),o}]),app.factory("MapService",["$rootScope",function(e){"use strict";var n=this;return n.untouched=[],n.canvas=null,n.markers=[],n.currentMarker=null,n.map=null,n.content=null,n.options={},n.location={"default":{lat:53.3540406,lng:-6.2589086},object:null},n.defaultMarker={options:{src:"images/pokeball.png",size:new google.maps.Size(35,35),scale:new google.maps.Size(35,35)},object:null},n.infoWindow={options:{content:null,maxWidth:400},object:null},n.area={options:{color:"#9acdd7",radius:20}},n.events={},n.events.infoWindowOpened=function(){$(".search-box").focus()},n.create=function(e){var o=new google.maps.LatLng(n.location["default"].lat,n.location["default"].lng);n.canvas=document.getElementById("map"),n.options={center:o,zoom:16,panControl:!0,scrollwheel:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},n.map=new google.maps.Map(n.canvas,n.options),n.defaultMarker.object=new google.maps.MarkerImage(n.defaultMarker.options.src,n.defaultMarker.options.size,null,null,n.defaultMarker.options.scale);var t=document.getElementById("pac-input"),r=new google.maps.places.SearchBox(t);n.map.controls[google.maps.ControlPosition.TOP_LEFT].push(t),n.map.addListener("bounds_changed",function(){r.setBounds(n.map.getBounds())}),r.addListener("places_changed",function(){var e=r.getPlaces();if(0!=e.length){var o=e[0];n.map.panTo(o.geometry.location)}})},n.setInfoWindowContent=function(e){isMobile&&(n.infoWindow.options.content=e,n.infoWindow.object=new google.maps.InfoWindow(n.infoWindow.options))},n.addListeners=function(){new LongPress(n.map,1e3),google.maps.event.addListener(n.map,"longpress",function(e){n.removeUntouchedMarkers();var o=n.placeMarker(e.latLng);n.untouched.push(o),$(".sidebar").removeClass("off"),$(".pokemon-selection-box").show()})},n.removeUntouchedMarkers=function(){n.map.clearMarkers(n.untouched)},n.marker=function(e){return new google.maps.Marker({position:e,map:n.map,icon:n.defaultMarker.object})},n.pokemonMarker=function(e,o){var t=n.marker(e);return t.setIcon(n.markerImage(o)),t},n.markerImage=function(e){return new google.maps.MarkerImage(e,new google.maps.Size(50,50),null,null,new google.maps.Size(50,50))},n.circle=function(e,o){return"undefined"==typeof e&&(e=n.area.options.color),"undefined"==typeof o&&(o=n.area.options.radius),new google.maps.Circle({map:n.map,radius:o,fillColor:e,strokeColor:e})},n.bindCircleToMarker=function(e,n){e.bindTo("center",n,"position"),n.circle=e},n.addInfoWindowToMarker=function(e){e.addListener("click",function(){n.selectedMarker=e,isMobile&&(n.infoWindow.object.open(n.map,e),n.events.infoWindowOpened(e)),n.applyPokemonFunction(e)})},n.placeMarker=function(e,o){var t,r=n.area.options.color;if("undefined"!=typeof o){if(t=$('[data-number="'+o.number+'"]')){var a=n.pokemonMarker(e,t.attr("src"));a.uuid=o.id,r=(new ColorThief).getColor(t[0]),r=rgbToHex(r[0],r[1],r[2])}}else var a=n.marker(e);var i=n.circle(r);return n.bindCircleToMarker(i,a),n.addInfoWindowToMarker(a),n.markers.push(a),a},n.applyPokemonFunction=function(){$(".remove-marker").off("click"),$(".remove-marker").on("click",function(){function e(){n.selectedMarker.setMap(null),n.selectedMarker.circle.setMap(null)}n.selectedMarker.uuid?$.post("api/remove",{uuid:n.selectedMarker.uuid},function(n){e()}):e()}),$(".search-box").off("keyup"),$(".search-box").on("keyup",function(){return""==$(this).val()?$(".pokemon-list img.pokemon").show():($(".pokemon-list img.pokemon").hide(),void $('.pokemon-list img.pokemon[data-query*="'+$(this).val().toLowerCase()+'"]').show())}),$(".pokemon-list img.pokemon").off("click"),$(".pokemon-list img.pokemon").on("click",function(e){angular.element($(this)).scope().events.select(e)})},n.clearAllMarkers=function(){n.map.clearMarkers(n.markers),n.markers=[]},n.init=function(e){n.create(e.map),n.setInfoWindowContent(e.content),n.addListeners(),e.callback&&"function"==typeof e.callback&&e.callback()},n}]),app.controller("MapController",["$scope","$http","InitService","MapService",function(e,n,o,t){"use strict";var r=this;e.events={},e.loading=!0,e.sidebar=!1,e.pokemon=[],e.events.select=function(e){var n=$(e.currentTarget),o=n.data("number"),r=$('[data-number="'+o+'"]').attr("src"),a=t.markerImage(r);t.selectedMarker.setIcon(a);var i=(new ColorThief).getColor($('[data-number="'+o+'"]')[0]);i=rgbToHex(i[0],i[1],i[2]),t.selectedMarker.circle.set("fillColor",i),t.selectedMarker.circle.set("strokeColor",i);var c=null;t.selectedMarker.hasOwnProperty("uuid")&&(c=t.selectedMarker.uuid),$.post("api/marker",{lat:t.selectedMarker.position.lat(),lng:t.selectedMarker.position.lng(),number:n.data("number"),uuid:c},function(e){t.selectedMarker.uuid=e.id,t.untouched=[]})},r.init=function(){r.loadPokemon(function(){t.init({map:document.getElementById("map"),content:$(".pokemon-list-template").html(),callback:r.callback})})},r.callback=function(){n.get("api/markers").success(function(n){for(var o in n){var r=n[o],a=JSON.parse(r.json);t.placeMarker(a,r)}e.loading=!1,$(".sidebar").removeClass("off")})},r.loadPokemon=function(o){n.get("api/pokemon").success(function(n){e.pokemon=n,o()})},o.addEventListener("ready",function(){google.maps.event.addDomListener(window,"load",r.init),$(".nav-search-box").off("keyup"),$(".nav-search-box").on("keyup",function(){return""==$(this).val()?$(".pokemon-nav-list .pokemon").show():($(".pokemon-nav-list .pokemon").hide(),void $('.pokemon-nav-list .pokemon[data-query*="'+$(this).val().toLowerCase()+'"]').show())}),$(".pokemon-nav-list .pokemon").off("click"),$(".pokemon-nav-list .pokemon").on("click",function(){t.clearAllMarkers()}),$(".close-sidebar").off("click"),$(".close-sidebar").on("click",function(){$(".sidebar").addClass("off")})})}]);